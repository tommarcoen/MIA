\documentclass[a4paper,12pt]{scrartcl}
\input{preamble}
\begin{document}
\maketitle



\section{Introduction}
The \abbr{MIA} project is based around monitoring.
Everything starts with setting up the necessary monitoring and then implementing the required changes to make the monitoring check succeed.
It's comparibly to test-driven programming where you first write the check and then the function to satisfy the check.
This way the monitoring is never an afterthought and you know from the get-go that the monitoring works.



\section{Scope of the project}
The main focus of the project will be web and mail hosting, including \abbr{DNS}.
We will assume a greenfield deployment in each of these three scenarios though this will be challenging for the setup of \abbr{DNS}.


\subsection{In scope}

\paragraph{Mail services}
Mail services will include setting up of all necessary \abbr{DNS} records, a Postfix email server for a single domain, an \abbr{IMAP} server for mail retrieval and possibly a webmail client though this will require setting up a website, load balancer\ldots

\paragraph{Web services}
Setting up a website will include the application server, database, web server, load balancer, certificates, and \abbr{DNS} records.

\paragraph{Single sign-on}
Authenticating against the different services and especially for accessing your emails should be possible using your Microsoft Active Directoy account.

\paragraph{Remote access \abbr{VPN}}
This topic might become in-scope if I can find a way to make it work easily.
The problem will be configuring the local firewall to allow for inbound traffic.


\subsection{Out of scope}
The local network will out of scope, i.e., this project does not aim to monitor and configure local switches or firewalls.









\section{Introduction}
The goal of the \abbr{MIA} project is to setup a complete network infrastructure based on monitoring.
Let's take a website as example.
The website begins with the \abbr{DNS} name so we build this into the monitoring environment: an \abbr{A} record check for the website we want to build.
Apart from the \abbr{A} record the monitoring environment will also check for \abbr{NS} records and monitor those name servers.

If a check fails we try to automatically rectify the problem.
In case of a missing \abbr{A} record, we will create the record with Ansible.
In case the name servers are down, we will spin up new servers on Digital Ocean or AWS with Terraform, install the needed software, modify \abbr{NS} and \abbr{A} records to point to these new servers and pusht he \abbr{DNS} configuration using Ansible.

Next we will poll the \abbr{DNS} name for ports \abbr{TCP}/80 and \abbr{TCP}/443.
The same rules apply here.
If they are down, spin up servers with Terraform, install the software, push the configuration files and get the web server running.
Better yet, get HAProxy running and spin up web servers as the backend behind HAProxy.
Monitor the load of your web servers and if the load becomes too high, spin up additional servers.



\section{Options}
Instead of spinning up new virtual machines in the cloud using Terraform, there should be an option to spin up container/jail instances on a given set of virtualization hosts.
This will obviously reduce the costs on the number of virtual machines, but will increase complexity as those virtualization hosts will need additional monitoring to determine whether extra containers/jails are permitted to be installed.



\section{Configuration files}
The end user will have to define configuration templates which can be pushed using Ansible.
This means that the user will have to provide at least a few options from which a Apache configuration file will be generated.
The same goes for \abbr{DNS}, HAproxy et cetera.
Though it is not likely the end user will have to modify anything to the default two-node name server setup and most load balancer configurations do not need any tweaking either.



\section{Monitoring}
The heart and soul of \abbr{MIA} is of course the monitoring dashboard from which you can see the health of the environment.
Not only does it have to provide a generic overview of the customer service (e.g., the website) but it will also have to account for dependancies.








\section{Workflow for a website}
When you want to add a new website, you start with entering the \abbr{FQDN}, e.g., www.marcoen.net.
This will immediately setup several checks:
\begin{itemize}
\item
    Perform a \abbr{DNS} lookup for the given \abbr{FQDN}.
\item
    Ping the \abbr{IP} address returned by the \abbr{DNS} lookup.
\item
    Check whether both \abbr{TCP}/80 and \abbr{TCP}/443 are opened on the given \abbr{IP} address.
\item
    Check whether the returned web page matches the expected web page.
\end{itemize}
At first all these checks will fail.
Some failed checks will trigger an action, e.g., when the \abbr{DNS} lookup fails, try to add the \abbr{DNS} record.
This can quickly lead you down a rabit hole though.
You will need to ask the user for credentials to authenticate to the master name server, or set it up if it does not yet exist.
You will need to ask the user for the \abbr{IP} address---something the user should not need to know.

\end{document}